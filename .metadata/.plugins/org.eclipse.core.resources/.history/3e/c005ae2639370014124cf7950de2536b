package by.pvt.resource.pool;

import by.pvt.resource.exception.OperatorTechnicalException;
import static by.pvt.resource.main.Runner.logger;

public class Client extends Thread {

	private boolean talking = false;
	private CallCenter<Operator> callCenter;

	public Client(CallCenter<Operator> callCenter, int i) {
		this.callCenter = callCenter;
		this.setName(String.valueOf(i));
	}

	public void run() {
		Operator operator = null;
		try {
			operator = callCenter.getOperator(500);
			talking = true;
			System.out.println("Client #" + this.getName()
					+ " is talking to operator #" + operator.getOperatorId());
			operator.talking();
		} catch (OperatorTechnicalException e) {
			logger.error("Client #" + this.getName() + " hung up ->", e);
		} finally {
			if (operator != null) {
				talking = false;
				System.out.println("Client #" + this.getName()
						+ " released operator #" + operator.getOperatorId());
				callCenter.releaseOperator(operator);
			}
		}
	}

	public boolean isTalking() {
		return talking;
	}
}
