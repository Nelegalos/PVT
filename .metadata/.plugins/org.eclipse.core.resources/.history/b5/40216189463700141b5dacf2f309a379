package by.pvt.resource.pool;

import by.pvt.resource.exception.OperatorTechnicalException;
import static by.pvt.resource.main.Runner.logger;

public class Client extends Thread {

	private boolean talking = false;
	private CallCenter<Operator> callCenter;

	public Client(CallCenter<Operator> callCenter) {
		this.callCenter = callCenter;
	}

	public void run() {
		Operator operator = null;
		try {
			operator = callCenter.getOperator(500);
			talking = true;
			System.out.println("Client #" + this.getId()
					+ " is talking to operator #" + operator.getOperatorId());
			operator.talking();
		} catch (OperatorTechnicalException e) {
			logger.info("Client #" + this.getId() + " hung up ->");
			try {
				Thread.sleep(1500);
				operator = callCenter.getOperator(500);
				talking = true;
				System.out.println("Client #" + this.getId()
						+ " called again and is talking to operator #"
						+ operator.getOperatorId());
				operator.talking();
			} catch (InterruptedException e1) {
				e1.printStackTrace();
			} catch (OperatorTechnicalException e1) {
				logger.info("Client #" + this.getId() + " hung up ->");
				e1.printStackTrace();
			}

		} finally {
			if (operator != null) {
				talking = false;
				System.out.println("Client #" + this.getId()
						+ " released operator #" + operator.getOperatorId());
				callCenter.releaseOperator(operator);
			}
		}
	}

	public boolean isTalking() {
		return talking;
	}
}
